{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 59dc717c1c992f6a8c84","webpack:///external \"mongoose\"","webpack:///./src/store/store.js","webpack:///external \"colors\"","webpack:///external \"net\"","webpack:///external \"network\"","webpack:///./src/index.js","webpack:///external \"babel-polyfill\"","webpack:///external \"pusher-js\"","webpack:///external \"lodash\"","webpack:///external \"body-parser\"","webpack:///./src/connectToDB.js","webpack:///./src/connectWithPeer.js","webpack:///external \"express\"","webpack:///./src/utils/findIPAddress.js","webpack:///external \"ip\"","webpack:///./src/store/reducer.js","webpack:///external \"redux\"","webpack:///./src/db/syncBlocksWithStore.js","webpack:///./src/classes/Block.js","webpack:///external \"js-sha256\"","webpack:///./src/models/Block.js","webpack:///external \"bluebird\"","webpack:///external \"dotenv\""],"names":["require","reducer","Redux","store","createStore","dispatch","addLoggingToDispatch","rawDispatch","action","console","log","type","yellow","Object","keys","join","green","returnValue","module","exports","config","app","use","json","urlencoded","extended","ipAddr","address","PUSHER_APP_KEY","DEFAULT_PORT","MAX_PEERS","handleConnection","conn","remoteAddr","remoteAddress","remotePort","blue","setEncoding","on","onConnData","onConnClose","onConnError","d","split","args","version","lastBlockHash","state","lastBlock","getState","write","header","getBlockHeaderHash","err","message","allPeers","startup","listen","process","env","PORT","gray","dbConnection","server","createServer","JSON","stringify","client","auth","params","ip_addr","port","cluster","authEndpoint","encrypted","numBlocks","channel","subscribe","bind","members","each","member","id","push","ip","slice","i","length","peer","newAllPeers","forEach","Promise","resolve","reject","connect","Error","connectToDB","Socket","data","toString","connectWithPeer","get_public_ip","findIPAddress","initialState","dbLoaded","nonce","difficulty","nodeCoin","count","findOne","sort","timestamp","limit","block","newBlock","previousHash","merkleHash","txs","blocksize","save","formatBlock","syncBlocksWithStore","setHeader","COIN","genesisPreviousHash","genesisMerkleRoot","genesisDifficulty","genesisNonce","genesisTimestamp","genesisTransaction","vin","n","prevout","vout","nValue","scriptPubKey","Block","isGenesis","Date","now","addTransaction","transaction","schema","default","Number","String","required","Array","BlockSchema","Schema","BlockModel","model"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;AC7DA,qC;;;;;;;;;ACAA,mBAAAA,CAAQ,CAAR;;AAEA,IAAMC,UAAU,mBAAAD,CAAA,EAAAA,CAAhB;;AAEA,IAAME,QAAQ,mBAAAF,CAAQ,EAAR,CAAd;;AAEA,IAAMG,QAAQD,MAAME,WAAN,CAAkBH,OAAlB,CAAd;;AAEAE,MAAME,QAAN,GAAiBC,qBAAqBH,KAArB,CAAjB;;AAEA,SAASG,oBAAT,CAA8BH,KAA9B,EAAqC;AACnC,MAAMI,cAAcJ,MAAME,QAA1B;AACA,SAAO,UAACG,MAAD,EAAY;AACjBC,YAAQC,GAAR,CAAY,gBAAaF,OAAOG,IAApB,EAA2BC,MAAvC;AACA;AACAH,YAAQC,GAAR,CAAY,cAAWG,OAAOC,IAAP,CAAYN,MAAZ,EAAoBO,IAApB,CAAyB,IAAzB,CAAX,EAA4CC,KAAxD;AACA,QAAMC,cAAcV,YAAYC,MAAZ,CAApB;AACA;AACA;AACA,WAAOS,WAAP;AACD,GARD;AASD;;AAEDC,OAAOC,OAAP,GAAiBhB,KAAjB,C;;;;;;ACvBA,mC;;;;;;ACAA,gC;;;;;;ACAA,oC;;;;;;;;;ACAA;;AACA;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;AAEA,mBAAAH,CAAQ,EAAR,EAAkBoB,MAAlB;;AAEA,IAAMC,MAAM,wBAAZ;AACAA,IAAIC,GAAJ,CAAQ,qBAAWC,IAAX,EAAR;AACAF,IAAIC,GAAJ,CAAQ,qBAAWE,UAAX,CAAsB,EAAEC,UAAU,KAAZ,EAAtB,CAAR;;AAEA;AACA,IAAMC,SAAS,aAAGC,OAAH,EAAf;AACA;;AAEA,IAAMC,iBAAiB,sBAAvB,C,CAA+C;AAC/C,IAAMC,eAAe,IAArB,C,CAA2B;AAC3B,IAAMC,YAAY,EAAlB;;AAEA,SAASC,gBAAT,CAA0BC,IAA1B,EAAgC;AAC9B,MAAMC,aAAgBD,KAAKE,aAArB,SAAsCF,KAAKG,UAAjD;AACA1B,UAAQC,GAAR,CAAY,mCAAgCuB,UAAhC,EAA6CG,IAAzD;;AAEAJ,OAAKK,WAAL,CAAiB,MAAjB;AACAL,OAAKM,EAAL,CAAQ,MAAR,EAAgBC,UAAhB;AACAP,OAAKM,EAAL,CAAQ,OAAR,EAAiBE,WAAjB;AACAR,OAAKM,EAAL,CAAQ,OAAR,EAAiBG,WAAjB;;AAEA,WAASF,UAAT,CAAoBG,CAApB,EAAuB;AAAA,mBACGA,EAAEC,KAAF,CAAQ,GAAR,CADH;AAAA;AAAA,QACfhC,IADe;AAAA,QACNiC,IADM;;AAErBnC,YAAQC,GAAR,8BAAuCuB,UAAvC,EAAqDS,CAArD,EAAwD/B,IAAxD;AACA,QAAIkC,gBAAJ;AAAA,QAAaC,sBAAb;AAAA,QAA4BC,cAA5B;AAAA,QAAmCC,kBAAnC;AACA,YAAOrC,IAAP;AACE,WAAK,SAAL;AACEkC,kBAAUD,KAAK,CAAL,CAAV;AACAE,wBAAgBF,KAAK,CAAL,CAAhB;AACAG,gBAAQ,gBAAME,QAAN,EAAR;AACAD,oBAAYD,MAAMC,SAAlB;AACAvC,gBAAQC,GAAR,CAAY,iCAAZ;AACAsB,aAAKkB,KAAL,CAAW,CAAE,SAAF,EAAaF,UAAUG,MAAV,CAAiBN,OAA9B,EAAuCG,UAAUI,kBAAV,EAAvC,EAAwErC,IAAxE,CAA6E,GAA7E,CAAX;AAPJ;AASD;AACD,WAASyB,WAAT,GAAuB;AACrB/B,YAAQC,GAAR,CAAY,2BAAZ,EAAyCuB,UAAzC;AACD;AACD,WAASQ,WAAT,CAAqBY,GAArB,EAA0B;AACxB5C,YAAQC,GAAR,CAAY,yBAAZ,EAAuCuB,UAAvC,EAAmDoB,IAAIC,OAAvD;AACD;AACF;;AAED,IAAIC,WAAW,EAAf;;AAGA,SAASC,OAAT,GAAmB;AACjBnC,MAAIoC,MAAJ,CAAWC,QAAQC,GAAR,CAAYC,IAAZ,IAAoB,IAA/B,0DAAqC;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AACnC;AACAnD,oBAAQC,GAAR,CAAY,8BAA8BmD,IAA1C,EAAgDH,QAAQC,GAAR,CAAYC,IAA5D,EAAkElC,MAAlE;;AAEA;AAJmC;AAAA,mBAKR,4BALQ;;AAAA;AAK7BoC,wBAL6B;;AAMnCrD,oBAAQC,GAAR,CAAY,+BAA+BmD,IAA3C;;AAEA;AACME,kBAT6B,GASpB,cAAIC,YAAJ,EAToB;;AAUnCD,mBAAOzB,EAAP,CAAU,YAAV,EAAwBP,gBAAxB;;AAEAgC,mBAAON,MAAP,CAAc5B,YAAd,EAA4B,SAA5B,EAAuC,YAAW;AAChDpB,sBAAQC,GAAR,CAAY,gCAAgCmD,IAA5C,EAAkDI,KAAKC,SAAL,CAAeH,OAAOpC,OAAP,EAAf,CAAlD;AACD,aAFD;;AAIA;AACMwC,kBAjB6B,GAiBpB,uBAAWvC,cAAX,EAA2B;AACxCwC,oBAAM,EAAEC,QAAQ,EAAEC,SAAS5C,MAAX,EAAmB6C,MAAM,IAAzB,EAAV,EADkC;AAExCC,uBAAS,KAF+B;AAGxCC,4BAAc,wDAH0B;AAIxCC,yBAAW;AAJ6B,aAA3B,CAjBoB;;AAwBnC;;AAxBmC;AAAA,mBAyBI,oCAzBJ;;AAAA;AAAA;AAyB3BC,qBAzB2B,SAyB3BA,SAzB2B;AAyBhB3B,qBAzBgB,SAyBhBA,SAzBgB;;;AA2BnCvC,oBAAQC,GAAR,CAAY,wCAAwCmD,IAApD;AACMe,mBA5B6B,GA4BnBT,OAAOU,SAAP,CAAiB,oBAAjB,CA5BmB;;AA8BnC;;AACAD,oBAAQE,IAAR,CAAa,+BAAb;AAAA,kFAA8C,iBAAOC,OAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAC5CtE,gCAAQC,GAAR,CAAY,4BAAZ,EAA0CqE,OAA1C;AACAxB,mCAAW,EAAX;AACAqB,gCAAQG,OAAR,CAAgBC,IAAhB,CAAqB,kBAAU;AAC7B,8BAAIC,OAAOC,EAAP,KAAcxD,MAAlB,EAA0B;AACxB6B,qCAAS4B,IAAT,CAAc,EAAEC,IAAIH,OAAOC,EAAb,EAAd;AACD;AACF,yBAJD;AAKA3B,mCAAWA,SAAS8B,KAAT,CAAe,CAAf,EAAkBvD,SAAlB,CAAX;AACA;AACA,wCAAMzB,QAAN,CAAe,EAAEM,MAAM,WAAR,EAAqB4C,kBAArB,EAAf;AACIP,iCAXwC,GAW5B,gBAAMC,QAAN,GAAiBD,SAXW;AAYxCF,qCAZwC,GAYxBE,UAAUI,kBAAV,EAZwB;AAaxCP,+BAbwC,GAa9BG,UAAUG,MAAV,CAAiBN,OAba;AAc5C;;AAEA;;AACSyC,yBAjBmC,GAiB/B,CAjB+B;;AAAA;AAAA,8BAiB5BA,IAAI/B,SAASgC,MAjBe;AAAA;AAAA;AAAA;;AAkBpCC,4BAlBoC,GAkB7BjC,SAAS+B,CAAT,CAlB6B;AAAA;AAAA,+BAmBpC,+BAAgBE,IAAhB,EAAsB1C,aAAtB,EAAqCD,OAArC,CAnBoC;;AAAA;AAiBPyC,2BAjBO;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAA9C;;AAAA;AAAA;AAAA;AAAA;;AAuBA;AACAV,oBAAQE,IAAR,CAAa,qBAAb,EAAoC,UAASG,MAAT,EAAgB;AAClD,kBAAI1B,WAAW,gBAAMN,QAAN,GAAiBM,QAAhC;AACAA,uBAAS4B,IAAT,CAAc,EAAEC,IAAIH,OAAOC,EAAb,EAAd;AACA,8BAAM7E,QAAN,CAAe,EAAEM,MAAM,WAAR,EAAqB4C,kBAArB,EAAf;AACA;AACD,aALD;;AAOA;AACAqB,oBAAQE,IAAR,CAAa,uBAAb,EAAsC,UAASG,MAAT,EAAgB;AACpDxE,sBAAQC,GAAR,CAAY,oBAAZ,EAAkCuE,MAAlC;AACA,kBAAI1B,WAAW,gBAAMN,QAAN,GAAiBM,QAAhC;AACA,kBAAIkC,cAAc,EAAlB;AACAlC,uBAASmC,OAAT,CAAiB,gBAAQ;AACvB,oBAAIF,KAAKJ,EAAL,KAAYH,OAAOC,EAAvB,EAA2B;AACzBO,8BAAYN,IAAZ,CAAiBK,IAAjB;AACD;AACF,eAJD;AAKA,8BAAMnF,QAAN,CAAe,EAAEM,MAAM,WAAR,EAAqB4C,UAAUkC,WAA/B,EAAf;AACA;AACD,aAXD;;AA/DmC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAArC;AA4ED;;AAEDjC,U;;;;;;AChJA,2C;;;;;;ACAA,sC;;;;;;ACAA,mC;;;;;;ACAA,wC;;;;;;;;;;;;;;qECEA;AAAA;AAAA;AAAA;AAAA;AAAA,6CACS,IAAImC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,iCAASC,OAAT,CAAiB,oCAAjB,EAAuD,UAACzC,GAAD,EAAS;AAC9D,oBAAIA,GAAJ,EAAS;AACP,wBAAM,IAAI0C,KAAJ,iCAAwC1C,GAAxC,CAAN;AACAwC,yBAAOxC,GAAP;AACD,iBAHD,MAGO;AACL;AACAuC,0BAAQ,IAAR;AACD;AACF,eARD;AASD,aAVM,CADT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;kBAAeI,W;;;;;AAFf;;;;;;;;kBAgBeA,W;;;;;;;;;;;;;;qECZf,iBAA+BR,IAA/B,EAAqC1C,aAArC,EAAoDD,OAApD;AAAA;AAAA;AAAA;AAAA;AAAA;AACEpC,oBAAQC,GAAR,CAAY,0BAAZ,EAAwC8E,IAAxC,EAA8C1C,aAA9C,EAA6DD,OAA7D;AACM0B,gBAFR,GAEe1C,YAFf;AAGQsC,kBAHR,GAGiB,IAAI,cAAI8B,MAAR,EAHjB;;AAIE9B,mBAAO2B,OAAP,CAAevB,IAAf,EAAqBiB,KAAKJ,EAA1B,EAA8B,YAAM;AAClC3E,sBAAQC,GAAR,CAAY,uBAAZ,EAAqC8E,IAArC;AACA,kBAAM7E,OAAO,SAAb;AACAwD,qBAAOjB,KAAP,CAAa,CAAEvC,IAAF,EAAQkC,OAAR,EAAiBC,aAAjB,EAAiC/B,IAAjC,CAAsC,GAAtC,CAAb;AACD,aAJD;;AAMAoD,mBAAO7B,EAAP,CAAU,MAAV,EAAkB,gBAAQ;AACxB7B,sBAAQC,GAAR,CAAY,cAAZ,EAA4BwF,KAAKC,QAAL,EAA5B;AACD,aAFD;;AAIAhC,mBAAO7B,EAAP,CAAU,OAAV,EAAmB,YAAM;AACvB7B,sBAAQC,GAAR,CAAY,qBAAZ;AACD,aAFD;;AAdF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;kBAAe0F,e;;;;;AAJf;;;;;;;;AAEA,IAAMvE,eAAe,IAArB;;kBAqBeuE,e;;;;;;ACvBf,oC;;;;;;;;;;;;;;qECEA;AAAA;AAAA;AAAA;AAAA;AAAA,6CACS,IAAIT,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,gCAAQQ,aAAR,CAAsB,UAAChD,GAAD,EAAM+B,EAAN,EAAa;AACjC,oBAAI/B,GAAJ,EAAS;AACPwC,yBAAOxC,GAAP;AACD;AACDuC,wBAAQR,EAAR;AACD,eALD;AAMD,aAPM,CADT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;kBAAekB,a;;;;;AAFf;;;;;;;;kBAaeA,a;;;;;;ACbf,+B;;;;;;;;;;;;;ACAA,IAAMC;AACJ;;;;;;;;AAQAC,YAAU,KATN;AAUJ7B,aAAW,CAVP;AAWJpB,YAAU,EAXN,EAWW;AACfP,aAAW,IAZP;AAaJH,WAAS,CAbL;AAcJ4D,SAAO,CAdH;AAeJC,cAAY;AAfR,gBAgBO,CAhBP,CAAN;;AAmBA,IAAMC,WAAW,SAAXA,QAAW,GAAkC;AAAA,MAAjC5D,KAAiC,uEAAzBwD,YAAyB;AAAA,MAAX/F,MAAW;;AACjD,UAAOA,OAAOG,IAAd;AACE,SAAK,yBAAL;AACE,0BACKoC,KADL;AAEEyD,kBAAU,IAFZ;AAGExD,mBAAWxC,OAAOwC,SAHpB;AAIE2B,mBAAWnE,OAAOmE;AAJpB;AAMF,SAAK,WAAL;AACE,0BACK5B,KADL;AAEE2D,oBAAYlG,OAAOkG,UAFrB;AAGED,eAAOjG,OAAOiG;AAHhB;AAKF,SAAK,WAAL;AACE,0BAAY1D,KAAZ,IAAmBQ,UAAU/C,OAAO+C,QAApC;AACF;AACE,aAAOR,KAAP;AAjBJ;AAmBD,CApBD;;AAsBA7B,OAAOC,OAAP,GAAiBwF,QAAjB,C;;;;;;ACzCA,kC;;;;;;;;;;;;;;qECIA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACwB,gBAAWC,KAAX,EADxB;;AAAA;AACMjC,qBADN;AAAA;AAAA,mBAEwB,gBAAWkC,OAAX,GAAqBC,IAArB,CAA0B,EAAEC,WAAW,CAAC,CAAd,EAA1B,EAA6CC,KAA7C,CAAmD,CAAnD,CAFxB;;AAAA;AAEMhE,qBAFN;;AAAA,kBAIM2B,aAAa,CAJnB;AAAA;AAAA;AAAA;;AAKQsC,iBALR,GAKgB,oBAAe,IAAf,EAAqB,IAArB,CALhB;AAMQC,oBANR,GAMmB,oBAAe;AAC5BrE,uBAASoE,MAAM9D,MAAN,CAAaN,OADM;AAE5BsE,4BAAcF,MAAM9D,MAAN,CAAagE,YAFC;AAG5BC,0BAAYH,MAAM9D,MAAN,CAAaiE,UAHG;AAI5BL,yBAAWE,MAAM9D,MAAN,CAAa4D,SAJI;AAK5BL,0BAAYO,MAAM9D,MAAN,CAAauD,UALG;AAM5BD,qBAAOQ,MAAM9D,MAAN,CAAasD,KANQ;AAO5BY,mBAAKJ,MAAMI,GAPiB;AAQ5BC,yBAAWL,MAAMK;AARW,aAAf,CANnB;AAAA;AAAA,mBAgBUJ,SAASK,IAAT,EAhBV;;AAAA;AAiBIvE,wBAAYkE,QAAZ;;AAjBJ;AAAA,yBAoBgClE,SApBhC,EAoBU0D,UApBV,cAoBUA,UApBV,EAoBsBD,KApBtB,cAoBsBA,KApBtB;AAqBE;;AACA,4BAAMpG,QAAN,CAAe,EAAEM,MAAM,WAAR,EAAqB+F,sBAArB,EAAiCD,YAAjC,EAAf;AACA,4BAAMpG,QAAN,CAAe,EAAEM,MAAM,yBAAR,EAAmCqC,WAAWwE,YAAYxE,SAAZ,CAA9C,EAAsE2B,oBAAtE,EAAf;AAvBF,6CAwBS,EAAEA,oBAAF,EAAa3B,oBAAb,EAxBT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;kBAAeyE,mB;;;;;AAJf;;;;AACA;;;;AACA;;;;;;;;AA6BA,SAASD,WAAT,CAAqBP,KAArB,EAA4B;AAC1B,MAAIC,WAAW,oBAAeD,MAAME,YAArB,EAAmC,KAAnC,EAA0CF,MAAMF,SAAhD,CAAf;AACAG,WAASQ,SAAT,CAAmBT,KAAnB;AACA,SAAOC,QAAP;AACD;;kBAEcO,mB;;;;;;;;;;;ACnCf;;;;;;;;AAFA,IAAMtH,QAAQ,mBAAAH,CAAA,CAAAA,CAAd;;AAIA,IAAM2H,OAAO,SAAb;AACA,IAAMC,sBAAsB,kEAA5B;AACA,IAAMC,oBAAoB,kEAA1B;AACA,IAAMC,oBAAoB,SAA1B;AACA,IAAMC,eAAe,UAArB;AACA,IAAMC,mBAAmB,aAAzB,C,CAAwC;AACxC,IAAMC,qBAAqB;AACzBC,OAAK,CAAE,EAAEC,GAAG,UAAL,EAAiBC,SAAS,IAA1B,EAAF,CADoB;AAEzBC,QAAM,CAAE,EAAEC,QAAQ,KAAKX,IAAf,EAAqBY,cAAc,oCAAnC,EAAF;AAFmB,CAA3B;;IAKMC,K;AACJ,iBAAYrB,YAAZ,EAAqE;AAAA,QAA3CsB,SAA2C,uEAA/B,KAA+B;AAAA,QAAxB1B,SAAwB,uEAAZ2B,KAAKC,GAAL,EAAY;;AAAA;;AACnE,QAAI5F,QAAQ5C,MAAM8C,QAAN,EAAZ;AACA,SAAKE,MAAL,GAAc;AACZN,eAASE,MAAMF,OADH;AAEZsE,oBAAcsB,YAAYb,mBAAZ,GAAkCT,YAFpC;AAGZC,kBAAYqB,YAAYZ,iBAAZ,GAAgC,IAHhC;AAIZd,iBAAW0B,YAAYT,gBAAZ,GAA+BjB,SAJ9B;AAKZL,kBAAY+B,YAAYX,iBAAZ,GAAgC/E,MAAM2D,UALtC;AAMZD,aAAOgC,YAAYV,YAAZ,GAA2BhF,MAAM0D;AAN5B,KAAd;AAQA,SAAKY,GAAL,GAAW,EAAX;AACA,QAAIoB,SAAJ,EAAe;AACb,WAAKG,cAAL,CAAoBX,kBAApB;AACD;AACD,SAAKX,SAAL,GAAiBrD,KAAKC,SAAL,CAAe,IAAf,EAAqBqB,MAAtC;AACD;;;;yCACoB;AAAA,oBACyD,KAAKpC,MAD9D;AAAA,UACXN,OADW,WACXA,OADW;AAAA,UACFsE,YADE,WACFA,YADE;AAAA,UACYC,UADZ,WACYA,UADZ;AAAA,UACwBL,SADxB,WACwBA,SADxB;AAAA,UACmCL,UADnC,WACmCA,UADnC;AAAA,UAC+CD,KAD/C,WAC+CA,KAD/C;;AAEnB,aAAO,qBAAO,CAAE5D,OAAF,EAAWsE,YAAX,EAAyBC,UAAzB,EAAqCL,SAArC,EAAgDL,UAAhD,EAA4DD,KAA5D,EAAmExC,KAAKC,SAAL,CAAe,KAAKmD,GAApB,CAAnE,EAA8FtG,IAA9F,CAAmG,GAAnG,CAAP,CAAP;AACD;;;8BACSoC,M,EAAQ;AAChB,WAAKA,MAAL,GAAc;AACZN,iBAASM,OAAON,OADJ;AAEZsE,sBAAchE,OAAOgE,YAFT;AAGZC,oBAAYjE,OAAOiE,UAHP;AAIZL,mBAAW5D,OAAO4D,SAJN;AAKZL,oBAAYvD,OAAOuD,UALP;AAMZD,eAAOtD,OAAOsD;AANF,OAAd;AAQA,aAAO,KAAKtD,MAAZ;AACD;;;mCACc0F,W,EAAa;AAC1B,WAAKxB,GAAL,CAASlC,IAAT,CAAc0D,WAAd;AACA,aAAO,KAAKxB,GAAZ;AACD;;;;;;AACF;;AAED;AACA;;AAEAnG,OAAOC,OAAP,GAAiBqH,KAAjB,C;;;;;;ACxDA,sC;;;;;;;;;;;;;ACAA;;;;;;AAEA,mBAAS7C,OAAT,GAAmB,mBAAA3F,CAAQ,EAAR,CAAnB;;AAEA,IAAM8I,SAAS;AACbjG,WAAS,EAAEkG,SAAS,CAAX,EAAcpI,MAAMqI,MAApB,EADI;AAEb7B,gBAAc,EAAExG,MAAMsI,MAAR,EAAgBC,UAAU,IAA1B,EAFD;AAGb9B,cAAY,EAAEzG,MAAMsI,MAAR,EAAgBC,UAAU,IAA1B,EAHC;AAIbnC,aAAW,EAAEpG,MAAMqI,MAAR,EAAgBE,UAAU,IAA1B,EAJE;AAKbxC,cAAY,EAAE/F,MAAMqI,MAAR,EAAgBE,UAAU,IAA1B,EALC;AAMbzC,SAAO,EAAE9F,MAAMqI,MAAR,EAAgBE,UAAU,IAA1B,EANM;AAOb7B,OAAK,EAAE1G,MAAMwI,KAAR,EAAeJ,SAAS,EAAxB,EAPQ;AAQbzB,aAAW,EAAE3G,MAAMqI,MAAR,EAAgBE,UAAU,IAA1B;AARE,CAAf;;AAWA,IAAME,cAAc,IAAI,mBAASC,MAAb,CAAoBP,MAApB,CAApB;;AAEA,IAAMQ,aAAa,mBAASC,KAAT,CAAe,QAAf,EAAyBH,WAAzB,CAAnB;;kBAEeE,U;;;;;;ACnBf,qC;;;;;;ACAA,mC","file":"nodecoin.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"events\"] = factory();\n\telse\n\t\troot[\"events\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 59dc717c1c992f6a8c84","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 0\n// module chunks = 0","require('colors');\n\nconst reducer = require('./reducer');\n\nconst Redux = require('redux');\n\nconst store = Redux.createStore(reducer);\n\nstore.dispatch = addLoggingToDispatch(store);\n\nfunction addLoggingToDispatch(store) {\n  const rawDispatch = store.dispatch;\n  return (action) => {\n    console.log(`> Action: ${action.type}`.yellow);\n    // console.log('> prev state'.gray, store.getState());\n    console.log(`> Keys: ${Object.keys(action).join(', ')}`.green);\n    const returnValue = rawDispatch(action);\n    // console.log('> next state'.green, store.getState());\n    // console.log(action.type.green);\n    return returnValue;\n  }\n}\n\nmodule.exports = store;\n\n\n\n// WEBPACK FOOTER //\n// ./src/store/store.js","module.exports = require(\"colors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"colors\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"net\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"net\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"network\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"network\"\n// module id = 4\n// module chunks = 0","import 'colors';\nimport 'babel-polyfill';\n\nimport Client from 'pusher-js';\nimport _ from 'lodash';\nimport bodyParser from 'body-parser';\nimport connectToDB from './connectToDB';\nimport connectWithPeer from './connectWithPeer';\nimport express from 'express';\nimport findIPAddress from 'utils/findIPAddress';\nimport ip from 'ip';\nimport mongoose from 'mongoose';\nimport net from 'net';\nimport network from 'network';\nimport store from 'store/store';\nimport syncBlocksWithStore from 'db/syncBlocksWithStore';\n\nrequire('dotenv').config();\n\nconst app = express();\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: false }));\n\n// get current IP address in use\nconst ipAddr = ip.address();\n// const ipAddr = '108.30.188.4';\n\nconst PUSHER_APP_KEY = '86e36fb6cb404d67a108'; // connect via public key\nconst DEFAULT_PORT = 8334; // default port for net connections\nconst MAX_PEERS = 25;\n\nfunction handleConnection(conn) {\n  const remoteAddr = `${conn.remoteAddress}:${conn.remotePort}`;\n  console.log(`> New client connection from ${remoteAddr}`.blue);\n\n  conn.setEncoding('utf8');\n  conn.on('data', onConnData);\n  conn.on('close', onConnClose);\n  conn.on('error', onConnError);\n\n  function onConnData(d) {\n    let [ type, ...args ] = d.split(' ');\n    console.log(`> Connection data from: ${remoteAddr}`, d, type);\n    let version, lastBlockHash, state, lastBlock;\n    switch(type) {\n      case 'VERSION':\n        version = args[0];\n        lastBlockHash = args[1];\n        state = store.getState();\n        lastBlock = state.lastBlock;\n        console.log('> Responding to VERSION request');\n        conn.write([ 'VERSION', lastBlock.header.version, lastBlock.getBlockHeaderHash() ].join(' '));\n    }\n  }\n  function onConnClose() {\n    console.log('connection from %s closed', remoteAddr);\n  }\n  function onConnError(err) {\n    console.log('Connection %s error: %s', remoteAddr, err.message);\n  }\n}\n\nlet allPeers = [ ];\n\n\nfunction startup() {\n  app.listen(process.env.PORT || 3000, async function() {\n    // const ipAddr = await findIPAddress();\n    console.log('> Server listening on port '.gray, process.env.PORT, ipAddr);\n\n    // connect to local instance of MongoDB\n    const dbConnection = await connectToDB();\n    console.log('> Connected to local MongoDB'.gray);\n\n    // create a TCP/IP server on current IP address\n    const server = net.createServer();\n    server.on('connection', handleConnection);\n\n    server.listen(DEFAULT_PORT, '0.0.0.0', function() {\n      console.log(`> TCP/IP server listening on:`.gray, JSON.stringify(server.address()));\n    });\n\n    // initialize presence channel via Pusher\n    const client = new Client(PUSHER_APP_KEY, {\n      auth: { params: { ip_addr: ipAddr, port: 8334 } },\n      cluster: 'us2',\n      authEndpoint: 'https://pusher-presence-auth.herokuapp.com/pusher/auth',\n      encrypted: true\n    });\n\n    // initialize blockchain (MongoDB local)\n    const { numBlocks, lastBlock } = await syncBlocksWithStore();\n\n    console.log('> Subscribing to broadcast changes...'.gray);\n    const channel = client.subscribe('presence-node-coin');\n\n    // SUCCESSFULLY JOINED\n    channel.bind('pusher:subscription_succeeded', async (members) => {\n      console.log('> Subscription succeeded: ', members);\n      allPeers = [ ];\n      channel.members.each(member => {\n        if (member.id !== ipAddr) {\n          allPeers.push({ ip: member.id });\n        }\n      });\n      allPeers = allPeers.slice(0, MAX_PEERS);\n      // console.log('> All peers: ', allPeers);\n      store.dispatch({ type: 'SET_PEERS', allPeers });\n      let lastBlock = store.getState().lastBlock;\n      let lastBlockHash = lastBlock.getBlockHeaderHash();\n      let version = lastBlock.header.version;\n      // console.log('> Last block hash: ', version, lastBlockHash);\n\n      // send version message to all peers, w/ version and last block hash\n      for (let i = 0; i < allPeers.length; i++) {\n        const peer = allPeers[i];\n        await connectWithPeer(peer, lastBlockHash, version);\n      }\n    });\n\n    // MEMBER ADDED\n    channel.bind('pusher:member_added', function(member){\n      let allPeers = store.getState().allPeers;\n      allPeers.push({ ip: member.id });\n      store.dispatch({ type: 'SET_PEERS', allPeers });\n      // TODO: send ping to new member to exchange headers\n    });\n\n    // MEMBER REMOVED\n    channel.bind('pusher:member_removed', function(member){\n      console.log('> Member removed: ', member);\n      let allPeers = store.getState().allPeers;\n      let newAllPeers = [ ];\n      allPeers.forEach(peer => {\n        if (peer.ip !== member.id) {\n          newAllPeers.push(peer);\n        }\n      });\n      store.dispatch({ type: 'SET_PEERS', allPeers: newAllPeers });\n      // TODO: stop any ongoing requests with peer\n    });\n  });\n}\n\nstartup();\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"babel-polyfill\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-polyfill\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"pusher-js\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pusher-js\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 9\n// module chunks = 0","import mongoose from 'mongoose';\n\nasync function connectToDB() {\n  return new Promise((resolve, reject) => {\n    mongoose.connect('mongodb://localhost:27017/nodecoin', (err) => {\n      if (err) {\n        throw new Error(`Error connecting to mongo. ${err}`);\n        reject(err);\n      } else {\n        // console.log('> Successfully conected to MongoDB 🔐');\n        resolve(true);\n      }\n    });\n  });\n}\n\nexport default connectToDB;\n\n\n\n// WEBPACK FOOTER //\n// ./src/connectToDB.js","import net from 'net';\n\nconst DEFAULT_PORT = 8334;\n\nasync function connectWithPeer(peer, lastBlockHash, version) {\n  console.log('> Connecting with peer: ', peer, lastBlockHash, version);\n  const port = DEFAULT_PORT;\n  const client = new net.Socket();\n  client.connect(port, peer.ip, () => {\n    console.log('> Connected to peer: ', peer);\n    const type = 'VERSION';\n    client.write([ type, version, lastBlockHash ].join(' '));\n  });\n\n  client.on('data', data => {\n    console.log('> Received: ', data.toString());\n  });\n\n  client.on('close', () => {\n    console.log('> Connection closed');\n  })\n}\n\nexport default connectWithPeer;\n\n\n\n// WEBPACK FOOTER //\n// ./src/connectWithPeer.js","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 12\n// module chunks = 0","import network from 'network';\n\nasync function findIPAddress() {\n  return new Promise((resolve, reject) => {\n    network.get_public_ip((err, ip) => {\n      if (err) {\n        reject(err);\n      }\n      resolve(ip);\n    });\n  });\n}\n\nexport default findIPAddress;\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/findIPAddress.js","module.exports = require(\"ip\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ip\"\n// module id = 14\n// module chunks = 0","const initialState = {\n  /*\n    this checks at start, connect to local mongo and load number of blocks -\n    let count = await Blocks.find({}).count();\n    Then load these variables.\n    If count == 0, hard code genesis block, then emit last block to peers\n    If count > 0, find last block - await Blocks.find({ }).sort({ timestamp: -1 }).limit(1);\n    Emit last block to peers to receive remaining blocks\n  */\n  dbLoaded: false,\n  numBlocks: 0,\n  allPeers: [ ], // list of { ip: String, port: Number }\n  lastBlock: null,\n  version: 1,\n  nonce: 0,\n  difficulty: 0,\n  numBlocks: 0,\n};\n\nconst nodeCoin = (state = initialState, action) => {\n  switch(action.type) {\n    case 'SET_INITIAL_BLOCK_COUNT':\n      return {\n        ...state,\n        dbLoaded: true,\n        lastBlock: action.lastBlock,\n        numBlocks: action.numBlocks,\n      };\n    case 'SET_NONCE':\n      return {\n        ...state,\n        difficulty: action.difficulty,\n        nonce: action.nonce,\n      };\n    case 'SET_PEERS':\n      return { ...state, allPeers: action.allPeers };\n    default:\n      return state;\n  }\n};\n\nmodule.exports = nodeCoin;\n\n\n\n// WEBPACK FOOTER //\n// ./src/store/reducer.js","module.exports = require(\"redux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redux\"\n// module id = 16\n// module chunks = 0","import BlockClass from 'classes/Block';\nimport BlockModel from 'models/Block';\nimport store from 'store/store';\n\nasync function syncBlocksWithStore() {\n  let numBlocks = await BlockModel.count();\n  let lastBlock = await BlockModel.findOne().sort({ timestamp: -1 }).limit(1);\n\n  if (numBlocks <= 0) {\n    let block = new BlockClass(null, true);\n    let newBlock = new BlockModel({\n      version: block.header.version,\n      previousHash: block.header.previousHash,\n      merkleHash: block.header.merkleHash,\n      timestamp: block.header.timestamp,\n      difficulty: block.header.difficulty,\n      nonce: block.header.nonce,\n      txs: block.txs,\n      blocksize: block.blocksize,\n    });\n    await newBlock.save();\n    lastBlock = newBlock;\n  }\n\n  const { difficulty, nonce } = lastBlock;\n  // update Redux store\n  store.dispatch({ type: 'SET_NONCE', difficulty, nonce });\n  store.dispatch({ type: 'SET_INITIAL_BLOCK_COUNT', lastBlock: formatBlock(lastBlock), numBlocks });\n  return { numBlocks, lastBlock };\n}\n\nfunction formatBlock(block) {\n  let newBlock = new BlockClass(block.previousHash, false, block.timestamp);\n  newBlock.setHeader(block);\n  return newBlock;\n}\n\nexport default syncBlocksWithStore;\n\n\n\n// WEBPACK FOOTER //\n// ./src/db/syncBlocksWithStore.js","const store = require('store/store');\n\nimport SHA256 from 'js-sha256';\n\nconst COIN = 100000000;\nconst genesisPreviousHash = '0000000000000000000000000000000000000000000000000000000000000000';\nconst genesisMerkleRoot = '4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b';\nconst genesisDifficulty = 486604799;\nconst genesisNonce = 2083236893;\nconst genesisTimestamp = 1231006505000; // Jan 3, 2009\nconst genesisTransaction = {\n  vin: [ { n: 'COINBASE', prevout: null } ],\n  vout: [ { nValue: 50 * COIN, scriptPubKey: '1Nd85AnFYDtaQAG6vF9FVWXFWksG5HuA3M' } ]\n};\n\nclass Block {\n  constructor(previousHash, isGenesis = false, timestamp = Date.now()) {\n    let state = store.getState();\n    this.header = {\n      version: state.version,\n      previousHash: isGenesis ? genesisPreviousHash : previousHash,\n      merkleHash: isGenesis ? genesisMerkleRoot : null,\n      timestamp: isGenesis ? genesisTimestamp : timestamp,\n      difficulty: isGenesis ? genesisDifficulty : state.difficulty,\n      nonce: isGenesis ? genesisNonce : state.nonce,\n    };\n    this.txs = [ ];\n    if (isGenesis) {\n      this.addTransaction(genesisTransaction);\n    }\n    this.blocksize = JSON.stringify(this).length;\n  }\n  getBlockHeaderHash() {\n    const { version, previousHash, merkleHash, timestamp, difficulty, nonce } = this.header;\n    return SHA256([ version, previousHash, merkleHash, timestamp, difficulty, nonce, JSON.stringify(this.txs) ].join(' '));\n  }\n  setHeader(header) {\n    this.header = {\n      version: header.version,\n      previousHash: header.previousHash,\n      merkleHash: header.merkleHash,\n      timestamp: header.timestamp,\n      difficulty: header.difficulty,\n      nonce: header.nonce,\n    };\n    return this.header;\n  }\n  addTransaction(transaction) {\n    this.txs.push(transaction);\n    return this.txs;\n  }\n};\n\n// let block = new Block(null, true); // genesis block\n// console.log('> Genesis block: ', block);\n\nmodule.exports = Block;\n\n\n\n// WEBPACK FOOTER //\n// ./src/classes/Block.js","module.exports = require(\"js-sha256\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"js-sha256\"\n// module id = 19\n// module chunks = 0","import mongoose from 'mongoose';\n\nmongoose.Promise = require('bluebird');\n\nconst schema = {\n  version: { default: 1, type: Number },\n  previousHash: { type: String, required: true },\n  merkleHash: { type: String, required: true },\n  timestamp: { type: Number, required: true },\n  difficulty: { type: Number, required: true },\n  nonce: { type: Number, required: true },\n  txs: { type: Array, default: [ ] },\n  blocksize: { type: Number, required: true },\n};\n\nconst BlockSchema = new mongoose.Schema(schema);\n\nconst BlockModel = mongoose.model('blocks', BlockSchema);\n\nexport default BlockModel;\n\n\n\n// WEBPACK FOOTER //\n// ./src/models/Block.js","module.exports = require(\"bluebird\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bluebird\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"dotenv\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv\"\n// module id = 22\n// module chunks = 0"],"sourceRoot":""}